=Module <<a_api_type | module Lwt_fmt >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Lwt_fmt>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Lwt_fmt >><<span class="ocsforge_color_keyword"|end>>>>~Format ~A~P~I for ~Lwt~-powered ~I~Os

----

~This module bridges the gap between
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html| <<span class="odocwiki_inlinecode"|~Format>>]]
    and <<a_api | module Lwt >>~. ~Although it is not required~, it is recommended to use this
    module with the [[http://erratique.ch/software/fmt| <<span class="odocwiki_inlinecode"|~Fmt>>]] library~.


    ~Compared to regular formatting function~, the main difference is that
    printing statements will now return promises instead of blocking~.
<<pre id="VALprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|printf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, unit <<a_api text="Lwt.t" | type Lwt.t >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<div class="odocwiki_info"|~Returns a promise that prints on the standard output~.
    ~Similar to
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html#VALprintf|
    <<span class="odocwiki_inlinecode"|~Format~.printf>>]]~.
>>
<<pre id="VALeprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|eprintf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>'a, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, unit <<a_api text="Lwt.t" | type Lwt.t >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<div class="odocwiki_info"|~Returns a promise that prints on the standard error~.
    ~Similar to
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html#VALeprintf|
    <<span class="odocwiki_inlinecode"|~Format~.eprintf>>]]~.
>>


=@@id="1_Formatters"@@~Formatters=

<<pre class="ocsforge_color odocwiki_code" id="TYPEformatter"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|formatter>>>><<div class="odocwiki_info"|~Lwt enabled formatters
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEorder"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|order>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|String>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string * int * int>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|~String ~(s~, off~, len~)>> indicate the output of <<span class="odocwiki_inlinecode"|s>> at offset <<span class="odocwiki_inlinecode"|off>> and length <<span class="odocwiki_inlinecode"|len>>~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Flush>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Flush operation
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>>>>>><<pre id="VALmake_stream" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|make~_stream>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="order" | type Lwt_fmt.order >> <<a_api text="Lwt_stream.t" | type Lwt_stream.t >> * <<a_api text="formatter" | type Lwt_fmt.formatter >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|make~_stream ~(~)>> returns a formatter and a stream of all the writing
    order given on that stream~.
>>
<<pre id="VALof_channel" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|of~_channel>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="Lwt_io.output_channel" | type Lwt_io.output_channel >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="formatter" | type Lwt_fmt.formatter >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|of~_channel oc>> creates a formatter that writes to the channel <<span class="odocwiki_inlinecode"|oc>>~.
>>
<<pre id="VALstdout" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|stdout>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="formatter" | type Lwt_fmt.formatter >>>>>><<div class="odocwiki_info"|~Formatter printing on <<a_api | val Lwt_io.stdout >>~.
>>
<<pre id="VALstderr" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|stderr>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="formatter" | type Lwt_fmt.formatter >>>>>><<div class="odocwiki_info"|~Formatter printing on <<a_api | val Lwt_io.stdout >>~.
>>
<<pre id="VALmake_formatter" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|make~_formatter>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| commit: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| fmt: >><<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="formatter" | type Lwt_fmt.formatter >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|make~_formatter ~~commit ~~fmt>> creates a new lwt formatter based on the
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html#TYPEformatter|
    <<span class="odocwiki_inlinecode"|~Format~.formatter>>]] <<span class="odocwiki_inlinecode"|fmt>>~. ~The <<span class="odocwiki_inlinecode"|commit>> function will be called by the
    printing functions to update the underlying channel~.
>>
<<pre id="VALget_formatter" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_formatter>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_formatter fmt>> returns the underlying
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html#TYPEformatter|
    <<span class="odocwiki_inlinecode"|~Format~.formatter>>]]~. ~To access the underlying formatter during printing~, it
    isvrecommended to use <<span class="odocwiki_inlinecode"|~%t>> and <<span class="odocwiki_inlinecode"|~%a>>~.
>>


==@@id="2_Printing"@@~Printing==

<<pre id="VALfprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fprintf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>'a, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, unit <<a_api text="Lwt.t" | type Lwt.t >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<pre id="VALkfprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|kfprintf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>'b, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, 'a<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'b>>>><<pre id="VALifprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|ifprintf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>'a, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, unit <<a_api text="Lwt.t" | type Lwt.t >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<pre id="VALikfprintf" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|ikfprintf>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >> <<span class="ocsforge_color_delimiter"| -> >> 'a<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >>'b, <<span class="ocsforge_color_uid"|Format>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|formatter>>, unit, 'a<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'b>>>><<pre id="VALflush" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|flush>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|flush fmt>> flushes the formatter ~(as with
    [[https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html#VALpp_print_flush|
    <<span class="odocwiki_inlinecode"|~Format~.pp~_print~_flush>>]]~) and
    executes all the printing action on the underlying channel~.
>>

~Low level functions
<<pre id="VALwrite_order" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|write~_order>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="Lwt_io.output_channel" | type Lwt_io.output_channel >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="order" | type Lwt_fmt.order >> <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|write~_order oc o>> applies the order <<span class="odocwiki_inlinecode"|o>> on the channel <<span class="odocwiki_inlinecode"|oc>>~.
>>
<<pre id="VALwrite_pending" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|write~_pending>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="formatter" | type Lwt_fmt.formatter >> <<span class="ocsforge_color_delimiter"| -> >> unit <<a_api text="Lwt.t" | type Lwt.t >>>>>><<div class="odocwiki_info"|~Write all the pending orders of a formatter~.
    ~Warning~: ~This function flush neither the internal format queues
    nor the underlying channel and is intended for low level use only~.
    ~You should probably use <<a_api | val Lwt_fmt.flush >> instead~.
>>
