=Module <<a_api_type subproject="server" | module Os_db >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Os_db>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db >><<span class="ocsforge_color_keyword"|end>>>>~This module defines low level functions for database requests~.

----
<<pre id="EXCEPTIONNo_such_resource" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|No_such_resource>>>><<div class="odocwiki_info"|~Exception raised when no ressource corresponds to the database request~.
>>
<<pre id="EXCEPTIONMain_email_removal_attempt" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Main_email_removal_attempt>>>><<div class="odocwiki_info"|~Exception raised when there is an attempt to remove the main email~.
>>
<<pre id="EXCEPTIONAccount_not_activated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Account_not_activated>>>><<div class="odocwiki_info"|~Exception raised when the account is not activated~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api subproject="server" text="PGOCaml" | module Os_db.PGOCaml >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|PGOCaml_generic.PGOCAML_GENERIC>>>><<span class="odocwiki_type"|  with type 'a monad = 'a Lwt.t>>>><<div class="odocwiki_info"|~Lwt version of ~P~G~O~Caml
>>
<<pre id="VALinit" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|init>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?host: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?port: >>int <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?user: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?database: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?unix_domain_socket_dir: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?pool_size: >>int <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?init: >><<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|pa_pg_data>> <<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|init ~?host ~?port ~?user ~?password ~?database ~?unix~_domain~_socket~_dir ~?init ~(~)>>
    initializes the variables for the database access and register a
    function <<span class="odocwiki_inlinecode"|init>> invoked each time a connection is created~.
>>
<<pre id="VALfull_transaction_block" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|full~_transaction~_block>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|pa_pg_data>> <<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|full~_transaction~_block f>> executes function <<span class="odocwiki_inlinecode"|f>> within a database
    transaction~. ~The argument of <<span class="odocwiki_inlinecode"|f>> is a ~P~G~O~Caml database handle~.
>>
<<pre id="VALwithout_transaction" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|without~_transaction>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|pa_pg_data>> <<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> 'a <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|without~_transaction f>> executes function <<span class="odocwiki_inlinecode"|f>> outside a database
    transaction~. ~The argument of <<span class="odocwiki_inlinecode"|f>> is a ~P~G~O~Caml database handle~.
>>
<<pre id="VALconnection_pool" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|connection~_pool>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|pa_pg_data>> <<span class="ocsforge_color_uid"|PGOCaml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_uid"|Lwt_pool>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Direct access to the connection pool
>>
<<pre id="VALpwd_crypt_ref" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|pwd~_crypt~_ref>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>string <<span class="ocsforge_color_delimiter"| -> >> string<<span class="ocsforge_color_delimiter"| ) >> * <<span class="ocsforge_color_delimiter"| ( >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> bool<<span class="ocsforge_color_delimiter"| ) >><<span class="ocsforge_color_delimiter"| ) >>\\  <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ref>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|pwd~_crypt~_ref>> is a reference to <<span class="odocwiki_inlinecode"|~(f~_crypt~, f~_check~)>> where
* <<span class="odocwiki_inlinecode"|f~_crypt pwd>> is used to encrypt the password <<span class="odocwiki_inlinecode"|pwd>>~.
* <<span class="odocwiki_inlinecode"|f~_check userid pwd hashed~_pwd>> returns <<span class="odocwiki_inlinecode"|true>> if the hash of <<span class="odocwiki_inlinecode"|pwd>> and
    the hashed password <<span class="odocwiki_inlinecode"|hashed~_pwd>> of the user with id <<span class="odocwiki_inlinecode"|userid>> match~. ~If they
    don~'t match~, it returns <<span class="odocwiki_inlinecode"|false>>~.

>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api subproject="server" text="Email" | module Os_db.Email >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db.Email >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~This module is used for low~-level email management with database~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api subproject="server" text="User" | module Os_db.User >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db.User >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~This module is used for low~-level user management with database~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api subproject="server" text="Groups" | module Os_db.Groups >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db.Groups >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~This module is low~-level and used to manage groups of user~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api subproject="server" text="Phone" | module Os_db.Phone >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db.Phone >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~Manage user phone numbers
>>
