=Module <<a_api_type subproject="server" | module Os_db.User >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|User>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_db.User >><<span class="ocsforge_color_keyword"|end>>>>~This module is used for low~-level user management with database~.

----
<<pre id="EXCEPTIONInvalid_action_link_key" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Invalid_action_link_key>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >>>>>><<pre id="VALuserid_of_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|userid~_of~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|userid~_of~_email email>> returns the userid of the user which has the email
      <<span class="odocwiki_inlinecode"|email>>~.
>>
<<pre id="VALis_registered" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_registered>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_registered email>> returns <<span class="odocwiki_inlinecode"|true>> if the email is already registered~.
      ~Else~, it returns <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALis_email_validated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_email~_validated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_email~_validated userid email>> returns <<span class="odocwiki_inlinecode"|true>> if <<span class="odocwiki_inlinecode"|email>> has been
      validated by the user with id <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALset_email_validated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_email~_validated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|set~_email~_validated userid email>> valids <<span class="odocwiki_inlinecode"|email>> for the user with id
      <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALadd_actionlinkkey" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_actionlinkkey>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?autoconnect: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?action: >>[< `AccountActivation | `Custom of string | `PasswordReset\\           > `AccountActivation ] <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?data: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?validity: >>int64 <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| act_key: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALadd_preregister" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_preregister>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|add~_preregister email>> preregisters <<span class="odocwiki_inlinecode"|email>> in the database~.
>>
<<pre id="VALremove_preregister" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove~_preregister>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|remove~_preregister email>> removes <<span class="odocwiki_inlinecode"|email>> from the database~.
>>
<<pre id="VALis_preregistered" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_preregistered>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_preregistered email>> returns <<span class="odocwiki_inlinecode"|true>> if <<span class="odocwiki_inlinecode"|email>> is already
      registered~. ~Else~, it returns <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALall" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|all>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| ?limit: >>int64 <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|all ~?limit ~(~)>> get all email addresses with a limit of <<span class="odocwiki_inlinecode"|limit>> ~(default
      is ~1~0~)~.
>>
<<pre id="VALcreate" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|create>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?avatar: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?language: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?email: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| firstname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| lastname: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|create ~?password ~?avatar ~?language ~~firstname ~~lastname email>> creates a new user
      in the database and returns the userid of the new user~.
      ~Email~, first name~, last name and language are mandatory to create a new
      user~.
      ~If <<span class="odocwiki_inlinecode"|password>> is passed as an empty string~, it fails with the message
      <<span class="odocwiki_inlinecode"|"empty password">>~. ~T~O~D~O~: change it to an exception~?
>>
<<pre id="VALupdate" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?avatar: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?language: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| firstname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| lastname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update ~?password ~?avatar ~?language ~~firstname ~~lastname userid>> updates the user
      profile with <<span class="odocwiki_inlinecode"|userid>>~.
      ~If <<span class="odocwiki_inlinecode"|password>> is passed as an empty string~, it fails with the message
      <<span class="odocwiki_inlinecode"|"empty password">>~. ~T~O~D~O~: change it to an exception~?
>>
<<pre id="VALupdate_password" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_password>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| password: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_password ~~userid ~~new~_password>> updates the password of the user
      with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
      ~If <<span class="odocwiki_inlinecode"|password>> is passed as an empty string~, it fails with the message
      <<span class="odocwiki_inlinecode"|"empty password">>~. ~T~O~D~O~: change it to an exception~?
>>
<<pre id="VALupdate_avatar" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_avatar>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| avatar: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_avatar ~~userid ~~avatar>> updates the avatar of the user
      with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALupdate_main_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_main~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_main~_email ~~userid ~~email>> updates the main email of the user
      with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALupdate_language" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_language>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| language: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_language ~~userid ~~language>> updates the language of the user with
      ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALverify_password" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|verify~_password>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| password: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|verify~_password ~~email ~~password>> returns the userid if user with email
      <<span class="odocwiki_inlinecode"|email>> is registered with the password <<span class="odocwiki_inlinecode"|password>>~. ~If <<span class="odocwiki_inlinecode"|password>> is empty
      or if the password is wrong~, it fails with <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALverify_password_phone" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|verify~_password~_phone>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| number: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| password: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|verify~_password~_phone ~~number ~~password>> returns the userid of
      the user who owns <<span class="odocwiki_inlinecode"|number>> and whose password is <<span class="odocwiki_inlinecode"|password>>~. ~If
      <<span class="odocwiki_inlinecode"|password>> is empty or if the password is wrong~, it fails with
      <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALuser_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|user~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> * string * string * string option * bool *\\   string option<<span class="ocsforge_color_delimiter"| ) >>\\  <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|user~_of~_userid userid>> returns a tuple <<span class="odocwiki_inlinecode"|~(userid~, firstname~, lastname~,
      avatar~, bool~_password~, language~)>> describing the information about
      the user with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
      <<span class="odocwiki_inlinecode"|bool~_password>> is a boolean~. ~Its value is <<span class="odocwiki_inlinecode"|true>> if a password has been
      set~. ~Else <<span class="odocwiki_inlinecode"|false>>~.
      ~If there is no such user~, it fails with <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALget_actionlinkkey_info" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_actionlinkkey~_info>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.Action_link_key.info" | type Os_types.Action_link_key.info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_actionlinkkey~_info key>> returns the information about the
      action link <<span class="odocwiki_inlinecode"|key>> as a type <<a_api subproject="server" | type Os_types.Action_link_key.info >>~.
>>
<<pre id="VALemails_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|emails~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|emails~_of~_userid userid>> returns all emails registered for the user with
      ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
      ~If there is no user with <<span class="odocwiki_inlinecode"|userid>> as ~I~D~, it fails with
      <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALemails_of_userid_with_status" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|emails~_of~_userid~_with~_status>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_delimiter"| ( >>string * bool<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Like <<span class="odocwiki_inlinecode"|emails~_of~_userid>>~, but also returns validation
      status~. ~This way we perform fewer ~D~B queries~.
>>
<<pre id="VALemail_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|email~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|email~_of~_userid userid>> returns the main email registered for the user
      with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
      ~If there is no such user~, it fails with
      <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALis_main_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_main~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_main~_email ~~email ~~userid>> returns <<span class="odocwiki_inlinecode"|true>> if the main email of the
      user with ~I~D <<span class="odocwiki_inlinecode"|userid>> is <<span class="odocwiki_inlinecode"|email>>~.
      ~If there is no such user or if <<span class="odocwiki_inlinecode"|email>> is not the main
      email~, it returns <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALadd_email_to_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_email~_to~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|add~_email~_to~_user ~~userid ~~email>> add <<span class="odocwiki_inlinecode"|email>> to user with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALremove_email_from_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove~_email~_from~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|remove~_email~_from~_user ~~userid ~~email>> removes the email <<span class="odocwiki_inlinecode"|email>> from the
      emails list of user with ~I~D <<span class="odocwiki_inlinecode"|userid>>~.
      ~If <<span class="odocwiki_inlinecode"|email>> is the main email~, it fails with <<a_api subproject="server" | exception Os_db.Main_email_removal_attempt >>~.
>>
<<pre id="VALget_language" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_language>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_language userid>> returns the language of the user with ~I~D <<span class="odocwiki_inlinecode"|userid>>
>>
<<pre id="VALget_users" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_users>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?pattern: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> * string * string * string option * bool *\\   string option<<span class="ocsforge_color_delimiter"| ) >>\\  list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_users ~~pattern ~(~)>> returns all users matching the pattern <<span class="odocwiki_inlinecode"|pattern>>
      as a tuple <<span class="odocwiki_inlinecode"|~(userid~, firstname~, lastname~, avatar~, bool~_password~,
      language~)>>~.
>>
