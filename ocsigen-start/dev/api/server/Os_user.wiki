=Module <<a_api_type subproject="server" | module Os_user >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Os_user>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api subproject="server" text=".." | module Os_user >><<span class="ocsforge_color_keyword"|end>>>>~This module provides functions and types about users~.

----
<<pre class="ocsforge_color odocwiki_code" id="TYPEid"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|id>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >>>> >><<div class="odocwiki_info"|~Type alias to <<a_api subproject="server" | type Os_types.User.id >> to allow to use <<span class="odocwiki_inlinecode"|~Os~_user~.id>>~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEt"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|t>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >>>>  <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|userid:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="id" | type Os_user.id >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|fn:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ln:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|avatar:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|language:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Type alias to <<a_api subproject="server" | type Os_types.User.t >> to allow to use <<span class="odocwiki_inlinecode"|~Os~_user~.t>>~.
>>
<<pre id="EXCEPTIONAlready_exists" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Already_exists>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >>>>>><<div class="odocwiki_info"|~Exception used if an user already exists~. ~The parameter is the userid of the
    existing user~.
>>
<<pre id="EXCEPTIONNo_such_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|No_such_user>>>><<div class="odocwiki_info"|~Exception used if an user doesn~'t exist~.
>>
<<pre id="VALpassword_set" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|password~_set>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|password~_set userid>> returns <<span class="odocwiki_inlinecode"|true>> if the user with ~I~D <<span class="odocwiki_inlinecode"|userid>> has set
    a password~. ~Else <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALwrong_password" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|wrong~_password>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remember if a wrong password has been already typed~.
>>
<<pre id="VALaccount_not_activated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|account~_not~_activated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remember if the account is activated~.
>>
<<pre id="VALuser_already_exists" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|user~_already~_exists>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remember if the user already exists~.
>>
<<pre id="VALuser_does_not_exist" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|user~_does~_not~_exist>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remember if the user exists~.
>>
<<pre id="VALuser_already_preregistered" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|user~_already~_preregistered>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remeber if the user is already preregistered~.
>>
<<pre id="VALaction_link_key_outdated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|action~_link~_key~_outdated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|bool <<span class="ocsforge_color_uid"|Eliom_reference>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Volatile>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|eref>>>>>><<div class="odocwiki_info"|~Reference used to remeber if an action link key is outdated~.
>>
<<pre id="VALuserid_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|userid~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|userid~_of~_user user>> returns the userid of the user <<span class="odocwiki_inlinecode"|user>>~.
>>
<<pre id="VALfirstname_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|firstname~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|firstname~_of~_user user>> returns the first name of the user <<span class="odocwiki_inlinecode"|user>>
>>
<<pre id="VALlastname_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|lastname~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|lastname~_of~_user user>> returns the last name of the user <<span class="odocwiki_inlinecode"|user>>
>>
<<pre id="VALavatar_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|avatar~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string option>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|avatar~_of~_user user>> returns the avatar of the user <<span class="odocwiki_inlinecode"|user>> as <<span class="odocwiki_inlinecode"|~Some
    avatar~_uri>>~. ~It returns <<span class="odocwiki_inlinecode"|~None>> if the user <<span class="odocwiki_inlinecode"|user>> has no avatar~.
>>
<<pre id="VALavatar_uri_of_avatar" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|avatar~_uri~_of~_avatar>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?absolute_path: >>bool <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Xml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|uri>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|avatar~_uri~_of~_avatar ~?absolute~_path avatar>> returns the ~U~R~I ~(absolute or
    relative~) depending on the value of <<span class="odocwiki_inlinecode"|absolute~_path>>~) of the avatar
    <<span class="odocwiki_inlinecode"|avatar>>~.
>>
<<pre id="VALavatar_uri_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|avatar~_uri~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?absolute_path: >>bool <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Xml>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|uri>> option>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|avatar~_uri~_of~_user user>> returns the avatar ~U~R~I ~(absolute or relative~)
    depending on the value of <<span class="odocwiki_inlinecode"|absolute~_path>>~) of the avatar of the user <<span class="odocwiki_inlinecode"|user>>~.
    ~It returns <<span class="odocwiki_inlinecode"|~None>> is the user <<span class="odocwiki_inlinecode"|user>> has no avatar~.
>>
<<pre id="VALlanguage_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|language~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string option>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|language~_of~_user user>> returns the language of the user <<span class="odocwiki_inlinecode"|user>>
>>
<<pre id="VALfullname_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|fullname~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|~Retrieve the full name of user ~(which is the concatenation of the first name
    and last name~)~.
>>
<<pre id="VALis_complete" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_complete>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_complete user>> returns <<span class="odocwiki_inlinecode"|true>> if the first name or the last name of
    <<span class="odocwiki_inlinecode"|~Os~_types~.user>> has not been completed yet~.
>>
<<pre id="VALemails_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|emails~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|emails~_of~_user user>> returns the emails of the user <<span class="odocwiki_inlinecode"|user>>~.
>>
<<pre id="VALadd_actionlinkkey" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_actionlinkkey>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?autoconnect: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?action: >>[ `AccountActivation | `Custom of string | `PasswordReset ] <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?data: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?validity: >>int64 <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| act_key: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|add~_actionlinkkey ~?autoconnect ~?action ~?data ~?validity ~~act~_key ~~userid
    ~~email ~(~)>> adds the action key in the database~.
>>
<<pre id="VALverify_password" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|verify~_password>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| password: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|verify~_password email password>> verifies if <<span class="odocwiki_inlinecode"|email>> and <<span class="odocwiki_inlinecode"|password>>
    correspond~. ~It it is the case~, it returns the userid of the user with email
    <<span class="odocwiki_inlinecode"|email>>~. ~Else~, it raises the exception <<a_api subproject="server" | exception Os_db.No_such_resource >>~.
>>
<<pre id="VALuser_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|user~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|user~_of~_userid userid>> returns the information about the user with ~I~D
    <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALget_actionlinkkey_info" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_actionlinkkey~_info>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.Action_link_key.info" | type Os_types.Action_link_key.info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Retrieve the data corresponding to an action link key~, each
    call decrements the validity of the key by <<span class="odocwiki_inlinecode"|~1>> if it exists and
    <<span class="odocwiki_inlinecode"|validity ~> ~0>> ~(it remains at <<span class="odocwiki_inlinecode"|~0>> if it~'s already <<span class="odocwiki_inlinecode"|~0>>~)~. ~It is up to
    you to adapt the actions according to the value of validity!
    ~Raises <<a_api subproject="server" | exception Os_db.No_such_resource >> if the action link key is not found~.
>>
<<pre id="VALuserid_of_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|userid~_of~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|userid~_of~_email email>> returns the userid of the user with email <<span class="odocwiki_inlinecode"|email>>~.
    ~It raises the exception <<a_api subproject="server" | exception Os_db.No_such_resource >> if the email <<span class="odocwiki_inlinecode"|email>> is
    not used~.
>>
<<pre id="VALemails_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|emails~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|emails~_of~_userid userid>> returns the emails list of user with ~I~D
    <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALemail_of_userid" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|email~_of~_userid>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|email~_of~_userid userid>> returns the main email of user with ~I~D
    <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALemails_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|emails~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|emails~_of~_user user>> returns the emails list of user <<span class="odocwiki_inlinecode"|user>>~.
>>
<<pre id="VALemail_of_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|email~_of~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|email~_of~_user user>> returns the main email of user <<span class="odocwiki_inlinecode"|user>>~.
>>
<<pre id="VALget_language" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_language>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_language userid>> returns the language of the user with ~I~D <<span class="odocwiki_inlinecode"|userid>>~. ~The
    language is retrieved from the database~.
>>
<<pre id="VALget_users" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_users>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| ?pattern: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|get~_users ~?pattern ~(~)>> gets users who match the <<span class="odocwiki_inlinecode"|pattern>> ~(useful for
    completion~)~.
>>
<<pre id="VALcreate" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|create>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?avatar: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?language: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?email: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| firstname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| lastname: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|create ~?password ~?avatar ~?language ~~firstname ~~lastname email>> creates a new user
    with the given information~. ~An email~, the first name and the last name are mandatory~.
>>
<<pre id="VALupdate" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?avatar: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?language: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| firstname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| lastname: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update ~?password ~?avatar ~?language ~~firstname ~~lastname userid>> update the
    given information of the user with ~I~D <<span class="odocwiki_inlinecode"|userid>>~. ~Only given information are
    updated~.
>>
<<pre id="VALupdate'" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~'>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| ?password: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api subproject="server" text="Os_types.User.t" | type Os_types.User.t >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Another version of <<span class="odocwiki_inlinecode"|update>> using a type <<a_api subproject="server" | type Os_types.User.t >> instead of
    label~.
>>
<<pre id="VALupdate_password" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_password>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| password: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_password ~~userid ~~password>> updates the password only~. <<span class="odocwiki_inlinecode"|password>>
    must not be hashed~: it is done by the function <<span class="odocwiki_inlinecode"|f~_crypt>> of the tuple
    <<a_api subproject="server" | val Os_db.pwd_crypt_ref >>~.
>>
<<pre id="VALupdate_avatar" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_avatar>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| avatar: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_avatar ~~userid ~~avatar>> updates the avatar of the user with ~I~D
    <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALupdate_language" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_language>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| language: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_language ~~userid ~~language>> updates the language of the user with ~I~D
    <<span class="odocwiki_inlinecode"|userid>>~.
>>
<<pre id="VALis_registered" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_registered>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_registered email>> returns <<span class="odocwiki_inlinecode"|true>> if a user exists with email <<span class="odocwiki_inlinecode"|email>>~.
    ~Else~, it returns <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALis_preregistered" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_preregistered>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_preregistered email>> returns <<span class="odocwiki_inlinecode"|true>> if a user exists with email
    <<span class="odocwiki_inlinecode"|email>>~. ~Else~, it returns <<span class="odocwiki_inlinecode"|false>>~.
>>
<<pre id="VALadd_preregister" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|add~_preregister>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|add~_preregister email>> adds an email into the preregister collections~.
>>
<<pre id="VALremove_preregister" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove~_preregister>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|remove~_preregister email>> removes an email from the preregister
    collections~.
>>
<<pre id="VALall" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|all>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| ?limit: >>int64 <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Get <<span class="odocwiki_inlinecode"|limit>> ~(default~: ~1~0~) emails from the preregister collections~.
>>
<<pre id="VALset_pwd_crypt_fun" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_pwd~_crypt~_fun>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>string <<span class="ocsforge_color_delimiter"| -> >> string<<span class="ocsforge_color_delimiter"| ) >> * <<span class="ocsforge_color_delimiter"| ( >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> bool<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit>>>><<div class="odocwiki_info"|~By default~, passwords are encrypted using ~Bcrypt~.
    ~You can customize this by calling this function
    with a pair of function ~(crypt and check password~)~.
    ~The first parameter of the second function is the user id
    ~(in case you need it~)~.
    ~Then it takes as second parameter the password given
    by user~, and as third parameter the hash found in database~.
>>
<<pre id="VALremove_email_from_user" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|remove~_email~_from~_user>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|remove~_email~_from~_user ~~userid ~~email>> removes the email <<span class="odocwiki_inlinecode"|email>> from the
    user with the id <<span class="odocwiki_inlinecode"|userid>>~. ~If the email is registered as the main email for
    the user it fails with the exception <<a_api subproject="server" | exception Os_db.Main_email_removal_attempt >>~.
>>
<<pre id="VALis_email_validated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_email~_validated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_email~_validated ~~userid ~~email>> returns whether for a user designated by
    its id the given email has been validated~.
>>
<<pre id="VALis_main_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|is~_main~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|is~_main~_email ~~userid ~~email>> returns whether an email is the main email
    registered for a given user designated by its id~.
>>
<<pre id="VALupdate_main_email" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_main~_email>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| userid: >><<a_api subproject="server" text="Os_types.User.id" | type Os_types.User.id >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| email: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|update~_mail~_email ~~userid ~~email>> sets the main email for a user with the
    ~I~D <<span class="odocwiki_inlinecode"|userid>> as the email <<span class="odocwiki_inlinecode"|email>>~.
>>
