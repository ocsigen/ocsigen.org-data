=Module <<a_api_type | module Ocsigen_extensions >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Ocsigen_extensions>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_extensions >><<span class="ocsforge_color_keyword"|end>>>>~Writing extensions for ~Ocsigen

----
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|include>> Ocsigen_command>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api text="Ocsigen_request_info" | module Ocsigen_extensions.Ocsigen_request_info >> <<span class="ocsforge_color_delimiter"|~:>> \\  <<span class="odocwiki_type"|module type of Ocsigen_request_info>><<span class="odocwiki_type"| \\                                with type request_info = Ocsigen_request_info.request_info\\                                 and type file_info = Ocsigen_request_info.file_info\\                                 and type ifrange = Ocsigen_request_info.ifrange>>>><<pre id="EXCEPTIONOcsigen_http_error" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Ocsigen_http_error>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<pre id="EXCEPTIONBad_config_tag_for_extension" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Bad_config_tag_for_extension>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Xml tag not recognized by an extension ~(usually not a real error~)
>>
<<pre id="EXCEPTIONError_in_config_file" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Error_in_config_file>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Error in a ~<site~> tag inside the main ocsigen~.conf file
>>
<<pre id="EXCEPTIONError_in_user_config_file" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Error_in_user_config_file>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Option incorrect in a userconf file
>>
<<pre id="VALbadconfig" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|badconfig>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'a, unit, string, 'b<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<div class="odocwiki_info"|~Convenient function for raising ~Error~_in~_config~_file exceptions with
    a sprintf~-formatted argument~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEvirtual_hosts"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string * <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> * int option<<span class="ocsforge_color_delimiter"| ) >> list>> >><<div class="odocwiki_info"|~Type of the result of parsing the field <<span class="odocwiki_inlinecode"|hostfiler>> in the configuration
    file~. ~Inside the list~, the first argument is the host itself
    ~(which is a glob~-like pattern that can contains <<span class="odocwiki_inlinecode"|~*>>~)~, a regexp
    parsing this pattern~, and optionnaly a port~.
>>
<<pre id="VALhash_virtual_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|hash~_virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALequal_virtual_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|equal~_virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<pre id="VALhost_match" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|host~_match>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| virtual_hosts: >><<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| host: >>string option <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| port: >>int <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEdo_not_serve"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|do~_not~_serve>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_regexps:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_files:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_extensions:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Configuration to hide~/forbid local files
>>
<<pre id="EXCEPTIONIncorrectRegexpes" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|IncorrectRegexpes>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>>>><<pre id="VALdo_not_serve_to_regexp" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|do~_not~_serve~_to~_regexp>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>>>>>><<div class="odocwiki_info"|~Compile a do~_not~_serve structure into a regexp~. ~Raises
    <<span class="odocwiki_inlinecode"|~Incorrect~Regexpes>> if the compilation fails~. ~The result is
    memoized for subsequent calls with the same argument
>>
<<pre id="VALjoin_do_not_serve" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|join~_do~_not~_serve>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEconfig_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|config~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_hostname:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_httpport:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_httpsport:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_protocol_is_https:>> <<span class="odocwiki_type"|bool>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|mime_assoc:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_charset_mime.mime_assoc" | type Ocsigen_charset_mime.mime_assoc >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|charset_assoc:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_charset_mime.charset_assoc" | type Ocsigen_charset_mime.charset_assoc >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_directory_index:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|list_directory_content:>> <<span class="odocwiki_type"|bool>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|follow_symlinks:>> <<span class="odocwiki_type"|<<a_api text="follow_symlink" | type Ocsigen_extensions.follow_symlink >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_404:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_403:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|uploaddir:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|maxuploadfilesize:>> <<span class="odocwiki_type"|int64 option>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Configuration options~, passed to ~(and modified by~) extensions
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEfollow_symlink"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|follow~_symlink>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|DoNotFollowSymlinks>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Never follow a symlink
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|FollowSymlinksIfOwnerMatch>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Follow a symlink if the symlink and its
                                   target have the same owner
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|AlwaysFollowSymlinks>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Always follow symlinks
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEclient"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|client>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_http_com.connection" | type Ocsigen_http_com.connection >>>> >><<div class="odocwiki_info"|~A value of this type represents the client who did the request~.
>>
<<pre id="VALclient_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|client~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="client" | type Ocsigen_extensions.client >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<div class="odocwiki_info"|~Returns the id number of the connection
>>
<<pre id="VALclient_connection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|client~_connection>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="client" | type Ocsigen_extensions.client >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Ocsigen_http_com.connection" | type Ocsigen_http_com.connection >>>>>><<div class="odocwiki_info"|~Returns the connection
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEifrange"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|ifrange>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Ocsigen_request_info>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ifrange>>>>  <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_No>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_Ifunmodsince>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|float>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_ifmatch>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEfile_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|file~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Ocsigen_request_info>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|file_info>>>>  <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|tmp_filename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|filesize:>> <<span class="odocwiki_type"|int64>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|raw_original_filename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|original_basename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|file_content_type:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> * <<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list<<span class="ocsforge_color_delimiter"| ) >> option>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<pre class="ocsforge_color odocwiki_code" id="TYPErequest_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Ocsigen_request_info>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|request_info>>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPErequest"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|request_info:>> <<span class="odocwiki_type"|<<a_api text="request_info" | type Ocsigen_extensions.request_info >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|request_config:>> <<span class="odocwiki_type"|<<a_api text="config_info" | type Ocsigen_extensions.config_info >>>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<pre id="EXCEPTIONOcsigen_Is_a_directory" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Ocsigen_Is_a_directory>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|Ocsigen_request_info>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|request_info>> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Neturl>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|url>><<span class="ocsforge_color_delimiter"| ) >>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEanswer"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|answer>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_do_nothing>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~I don~'t want to do anything
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|"~O~K stop! ~I will take the page~.
      ~You can start the following request of the same pipelined connection~.
      ~Here is the function to generate the page"~.
      ~The extension must return ~Ext~_found as soon as possible
      when it is sure it is safe to start next request~.
      ~Usually as soon as you know that the result will be ~Ext~_found~.
      ~But in some case~, for example proxies~, you don~'t want the request of
      one connection to be handled in different order~.
      ~In that case~, wait to be sure that the new request will not
      overtake this one~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_stop>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Found but do not try next extensions
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_next>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|int>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Page not found~. ~Try next extension~.
                        ~The integer is the ~H~T~T~P error code~.
                        ~It is usally ~4~0~4~, but may be for ex ~4~0~3 ~(forbidden~)
                        if you want another extension to try after a ~4~0~3~.
                        ~Same as ~Ext~_continue~_with but does not change
                        the request~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_site>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Error~. ~Do not try next extension~, but
      try next site~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_host>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Error~. ~Do not try next extension~,
      do not try next site~,
      but try next host~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_all>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Error~. ~Do not try next extension ~(even filters~)~,
      do not try next site~,
      do not try next host~,
      do not ~.
      ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_continue_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="request" | type Ocsigen_extensions.request >> * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Used to modify the request before giving it to next extension~.
      ~The extension returns the request~_info ~(possibly modified~)
      and a set of cookies if it wants to set or cookies
      ~(<<span class="odocwiki_inlinecode"|!~Ocsigen~_cookies~.~Cookies~.empty>> for no cookies~)~.
      ~You must add these cookies yourself in request~_info if you
      want them to be seen by subsequent extensions~,
      for example using <<a_api | val Ocsigen_http_frame.compute_new_ri_cookies >>~.
      ~The integer is usually equal to the error code received
      from preceding extension ~(but you may want to modify it~)~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_retry_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Used to retry all the extensions with a new request~_info~.
      ~The extension returns the request~_info ~(possibly modified~)
      and a set of cookies if it wants to set or cookies
      ~(<<span class="odocwiki_inlinecode"|!~Ocsigen~_cookies~.~Cookies~.empty>> for no cookies~)~.
      ~You must add these cookies yourself in request~_info if you
      want them to be seen by subsequent extensions~,
      for example using <<a_api | val Ocsigen_http_frame.compute_new_ri_cookies >>~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_sub_result>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="extension2" | type Ocsigen_extensions.extension2 >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Used if your extension want to define option that may contain
      other options from other extensions~.
      ~In that case~, while parsing the configuration file~, call
      the parsing function ~(of type <<span class="odocwiki_inlinecode"|parse~_fun>>~)~,
      that will return something of type <<span class="odocwiki_inlinecode"|extension~2>>~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_continue_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >>\\     <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>> * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Same as <<span class="odocwiki_inlinecode"|~Ext~_found>> but may modify the request~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_continue_with'>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>> * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|<<div class="odocwiki_info"|~Same as <<span class="odocwiki_inlinecode"|~Ext~_found~_continue~_with>> but does not allow to delay
      the computation of the page~. ~You should probably not use it~,
      but for output filters~.
>>
>><<span class="odocwiki_comments_close"| ~*)>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPErequest_state"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request~_state>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Req_not_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>int * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >>>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Req_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="request" | type Ocsigen_extensions.request >> * <<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>><<span class="ocsforge_color_delimiter"| ) >>>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEextension2"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|extension~2>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> <<span class="ocsforge_color_delimiter"| -> >>\\  request_state <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_delimiter"| ( >>answer * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEextension"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|extension>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api text="request_state" | type Ocsigen_extensions.request_state >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="answer" | type Ocsigen_extensions.answer >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>> >><<div class="odocwiki_info"|~For each ~<site~> tag in the configuration file~,
    you can set the extensions you want~.
    ~Each extension is implemented as a function~, taking
    the charset found in configuration file~,
    the current state of the request~,
    and returning an answer~.
    ~If no page has been generated so far ~(<<span class="odocwiki_inlinecode"|~Req~_not~_found>>~)~, it receive
    the error code given by the previous extension ~(default ~4~0~4~)~,
    and the request information~.
    ~If a page has been generated by previous extensions ~(case <<span class="odocwiki_inlinecode"|~Req~_found>>~)~,
    the extension may want to modify the result ~(filters~)~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_fun"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_fun>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> list <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="extension2" | type Ocsigen_extensions.extension2 >>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEparse_host"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_host>>>><<div class="odocwiki_info"|~Type of the functions parsing the content of a ~<host~> tag
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEuserconf_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|userconf~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|localfiles_root:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Information received by extensions accepting userconf files~.


    ~The parameter <<span class="odocwiki_inlinecode"|localfiles~_root>> is an absolute path to the
    directory that the user is allowed to serve~. ~This is used
    by staticmod~, to disallow the user from allowing access to
    outside of this directory
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="config_info" | type Ocsigen_extensions.config_info >> <<span class="ocsforge_color_delimiter"| -> >> parse_config_aux>> >><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|parse~_config>> is the type of the functions parsing a ~<site~> tag
    ~(and returning an extension~)~.  ~Those are functions taking
    
* the name of the virtual ~<host~>

     that will be called for each ~<host~>~,
     and that will generate a function taking~:
    
* the path attribute of a ~<site~> tag

     that will be called for each ~<site~>~,
     and that will generate a function taking~:
    
* an item of the config file

     that will be called on each tag inside ~<site~> and~:
    
* raise <<span class="odocwiki_inlinecode"|~Bad~_config~_tag~_for~_extension>> if it does not recognize that tag
* return something of type <<span class="odocwiki_inlinecode"|extension>> ~(filter or page generator~)



    <<span class="odocwiki_inlinecode"|parse~_config~_user>> is the type of functions parsing a site tag
    inside an userconf file~. ~They take one more parameter~, of type userconf~_info
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_user"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config~_user>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api text="userconf_info" | type Ocsigen_extensions.userconf_info >> <<span class="ocsforge_color_delimiter"| -> >> parse_config>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_aux"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config~_aux>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Ocsigen_lib>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Url>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|path>> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="parse_host" | type Ocsigen_extensions.parse_host >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="parse_fun" | type Ocsigen_extensions.parse_fun >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="extension" | type Ocsigen_extensions.extension >>>> >><<pre id="VALregister_extension" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|register~_extension>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| name: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?fun_site: >><<a_api text="parse_config" | type Ocsigen_extensions.parse_config >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?user_fun_site: >><<a_api text="parse_config_user" | type Ocsigen_extensions.parse_config_user >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?begin_init: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?end_init: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?init_fun: >><<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> list <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?exn_handler: >><<span class="ocsforge_color_delimiter"| ( >>exn <<span class="ocsforge_color_delimiter"| -> >> string<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| ?respect_pipeline: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~For each extension generating pages~, we register its name and six functions~:
* a function <<span class="odocwiki_inlinecode"|fun~_site>> of type <<span class="odocwiki_inlinecode"|parse~_config>>~. ~This function
    will be responsible for handling the options of the configuration
    files that are recognized by the extension~, and potentially generating
    a page~.
* a function <<span class="odocwiki_inlinecode"|user~_fun~_site>> of type <<span class="odocwiki_inlinecode"|parse~_user~_config>> which has the
    same role as <<span class="odocwiki_inlinecode"|fun~_site>>~, but inside userconf files~. ~Specify nothing
    if your extension is disallowed in userconf files~. ~Otherwise~, compared
    to <<span class="odocwiki_inlinecode"|fun~_site>>~, you can selectively disallow some options~,
    as <<span class="odocwiki_inlinecode"|user~_fun~_site>> must define only safe options ~(for example it is not
    safe to allow such options to load a cmo specified by a user~, or to
    execute a program~, as this program will be executed by ocsigen~'s user~)~.
    ~Note that <<span class="odocwiki_inlinecode"|user~_fun~_site>> will be called for every request~, whereas the
    <<span class="odocwiki_inlinecode"|fun~_site>> is called only when starting or reloading the server~.
* a function <<span class="odocwiki_inlinecode"|begin~_init>> that will be called at the beginning
    of the initialisation phase of each site~, and each time the config file is
    reloaded~.
* a function <<span class="odocwiki_inlinecode"|end~_init>> that will be called at the end of the initialisation
    phase of each site
* a function <<span class="odocwiki_inlinecode"|init~_fun>> that will be called just before registering the
    extension~, taking as parameter the configuration options between
    <<span class="odocwiki_inlinecode"|~<extension~>>> and <<span class="odocwiki_inlinecode"|~<~/extension~>>>~. ~This allows to give configuration options
    to extensions~. ~If no function is supplied~, the extension is supposed to
    accept no option ~(and loading will fail if an option is supplied~)
    ~See ~<~<a~_api module~="~Ocsigen~_extensions~.~Configuration" ~| val process~_elements ~>~> for
    the easy construction of such a function~.
* a function <<span class="odocwiki_inlinecode"|exn~_handler>> that will create an error message from the
    exceptions that may be raised during the initialisation phase~, and raise again
    all other exceptions

    ~Moreover~, if the optional parameter <<span class="odocwiki_inlinecode"|~?respect~_pipeline>> is <<span class="odocwiki_inlinecode"|true>>~,
    the extension will ask the server to respect the order of the
    pipeline~. ~That means that it will wait to be sure that the previous
    request from the same connection has been taken by an extension
    before giving a request to an extension~.  ~Use this to write proxies
    extensions~, when you want to be able to pipeline the requests you
    to another server~. ~It is false by default~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api text="Configuration" | module Ocsigen_extensions.Configuration >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_extensions.Configuration >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~This modules contains types and constructor for the description of ~X~M~L
    configurations and the accordingly parsing~.
>>
<<pre id="VALget_hostname" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_hostname>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|~Returns the hostname to be used for absolute links or redirections~.
    ~It is either the ~Host header or the hostname set in
    the configuration file~.
>>
<<pre id="VALget_port" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_port>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<div class="odocwiki_info"|~Returns the port to be used for absolute links or redirections~.
    ~It is either~:
* the port the server is listening at
* or the port in the ~Host header
* or the default port set in the configuration file~.

>>
<<pre id="VALnew_url_of_directory_request" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|new~_url~_of~_directory~_request>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="request" | type Ocsigen_extensions.request >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="request_info" | type Ocsigen_extensions.request_info >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Neturl>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|url>>>>>><<div class="odocwiki_info"|new~_url~_of~_directory~_request create a redirection and generating a new url
    for the client ~(depending on the server configuration and request~)
>>
<<pre id="VALri_of_url" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|ri~_of~_url>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?full_rewrite: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  string <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="request_info" | type Ocsigen_extensions.request_info >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="request_info" | type Ocsigen_extensions.request_info >>>>>><<div class="odocwiki_info"|~Parsing ~U~R~Ls~.
    ~This allows to modify the ~U~R~L in the request~_info~.
    ~(to be used for example with ~Ext~_retry~_with or ~Ext~_continue~_with~)
>>


===@@id="3_Userdirectories"@@~User directories===


~Exception raised when an non~-existing user is found
<<pre id="EXCEPTIONNoSuchUser" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|NoSuchUser>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEud_string"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|ud~_string>>>><<div class="odocwiki_info"|~The type for string that may contain a ~$u~(~.~.~.~)
>>
<<pre id="VALparse_user_dir" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|parse~_user~_dir>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="ud_string" | type Ocsigen_extensions.ud_string >>>>>><<pre id="VALreplace_user_dir" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|replace~_user~_dir>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="ud_string" | type Ocsigen_extensions.ud_string >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|raises <<span class="odocwiki_inlinecode"|~Not~_found>> is the directory does not exist
>>
<<pre id="EXCEPTIONNot_concerned" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Not_concerned>>>><<div class="odocwiki_info"|
===@@id="3_Regularexpressionsforredirections"@@~Regular expressions for redirections===

>>
<<pre id="VALfind_redirection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|find~_redirection>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> <<span class="ocsforge_color_delimiter"| -> >>\\  bool <<span class="ocsforge_color_delimiter"| -> >>\\  string <<span class="ocsforge_color_delimiter"| -> >>\\  bool <<span class="ocsforge_color_delimiter"| -> >>\\  string option <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string>>>><<pre id="VALmake_parse_config" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|make~_parse~_config>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Ocsigen_lib>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Url>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|path>> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="parse_config_aux" | type Ocsigen_extensions.parse_config_aux >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="parse_fun" | type Ocsigen_extensions.parse_fun >>>>>><<pre id="VALparse_config_item" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|parse~_config~_item>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="parse_config" | type Ocsigen_extensions.parse_config >>>>>><<pre id="VALparse_user_site_item" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|parse~_user~_site~_item>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="parse_config_user" | type Ocsigen_extensions.parse_config_user >>>>>><<pre id="VALset_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> * <<a_api text="config_info" | type Ocsigen_extensions.config_info >> *\\   <<a_api text="extension2" | type Ocsigen_extensions.extension2 >><<span class="ocsforge_color_delimiter"| ) >>\\  list <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALget_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  unit <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> * <<a_api text="config_info" | type Ocsigen_extensions.config_info >> *\\   <<a_api text="extension2" | type Ocsigen_extensions.extension2 >><<span class="ocsforge_color_delimiter"| ) >>\\  list>>>><<pre id="VALcompute_result" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|compute~_result>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?previous_cookies: >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?awake_next_request: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="request_info" | type Ocsigen_extensions.request_info >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Ocsigen_http_frame>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|result>> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Compute the result to be sent to the client~,
    by trying all extensions according the configuration file~.
>>
<<pre id="VALget_number_of_connected" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_number~_of~_connected>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> int>>>><<div class="odocwiki_info"|~Profiling
>>
<<pre id="VALget_number_of_connected" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_number~_of~_connected>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALincr_connected" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|incr~_connected>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|int <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~Server internal functions~:
>>
<<pre id="VALdecr_connected" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|decr~_connected>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALwait_fewer_connected" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|wait~_fewer~_connected>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|int <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALduring_initialisation" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|during~_initialisation>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<pre id="VALstart_initialisation" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|start~_initialisation>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALend_initialisation" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|end~_initialisation>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALget_numberofreloads" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_numberofreloads>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALget_init_exn_handler" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_init~_exn~_handler>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> exn <<span class="ocsforge_color_delimiter"| -> >> string>>>><<pre id="VALset_config" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_config>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> list <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<pre id="VALclient_of_connection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|client~_of~_connection>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_http_com.connection" | type Ocsigen_http_com.connection >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="client" | type Ocsigen_extensions.client >>>>>><<pre id="VALget_server_address" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_server~_address>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="request_info" | type Ocsigen_extensions.request_info >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Unix>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|inet_addr>> * int>>>><<pre id="VALsockets" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|sockets>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Lwt_unix>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|file_descr>> list <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ref>>>>>><<pre id="VALsslsockets" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|sslsockets>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Lwt_unix>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|file_descr>> list <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|ref>>>>>>